'use client';

import { WaveShaderMaterialProps } from "@/three/shaders/WaveShaderMaterial/global";

import { ThreeElements, useFrame, useLoader, useThree } from "@react-three/fiber";
import { Float } from '@react-three/drei'
import * as THREE from 'three'

import { forwardRef, useRef } from "react";
import { MotionValue, useScroll, useTransform } from "framer-motion";

interface FlagProps {
  mouse: {
    x: MotionValue<number>
    y: MotionValue<number>
  }
}

function BrazilFlag({ mouse }: FlagProps, ref: React.ForwardedRef<HTMLDivElement>) {
  const mesh = useRef<THREE.Mesh>(null!)
  const shader = useRef<WaveShaderMaterialProps>(null!)


  const [image] = useLoader(THREE.TextureLoader, [
    "data:image/jpeg;base64,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"
  ])

  useFrame(({ clock }, dt) => {
    const flag = mesh.current;
    const timeStamp = clock.getElapsedTime()
    if (!flag) return

    shader.current.uTime = timeStamp
    flag.rotation!.x = (mouse.y.get() - .5) * (Math.PI / 3);
    flag.rotation!.y = (mouse.x.get() - .5) * (Math.PI / 3);

    const newZPosition = flag.position!.z * (mouse.x.get() - .5) * (mouse.y.get() - .5)
    flag.position!.z = newZPosition
  })

  return (
    <Float>
      <mesh
        ref={mesh as any}
        position={[-10, -10, -0]}
      >
        <planeBufferGeometry args={[25, 15, 8, 8]} />
        <waveShaderMaterial ref={shader} uTexture={image} uScreenWidth={109} uColor={"green"} />
      </mesh>
    </Float>
  )
}

export default forwardRef(BrazilFlag)